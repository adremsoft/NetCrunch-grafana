'use strict';System.register(['./queryParser','./defaultEnglishMonitoringPacks'],function(_export){'use strict';var QueryParser,NetCrunchDefaultEnglishMonitoringPacks,_createClass,NetCrunchMetricFindQuery;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}return{setters:[function(_queryParser){QueryParser=_queryParser.QueryParser},function(_defaultEnglishMonitoringPacks){NetCrunchDefaultEnglishMonitoringPacks=_defaultEnglishMonitoringPacks.NetCrunchDefaultEnglishMonitoringPacks}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();_export('NetCrunchMetricFindQuery',NetCrunchMetricFindQuery=function(){function NetCrunchMetricFindQuery(a,b){_classCallCheck(this,NetCrunchMetricFindQuery),this.datasource=a,this.query=b}return _createClass(NetCrunchMetricFindQuery,[{key:'process',value:function(){var a=NetCrunchMetricFindQuery.parseQuery(this.query);return a.completeParsed?Promise.all([this.datasource.nodes(),this.datasource.atlas()]).then(function(b){var c=b[1],d=b[0].all,e=NetCrunchMetricFindQuery.processQuery(a.tokens,c,d);return NetCrunchMetricFindQuery.createQueryResult(e.success?e.nodes:[])}):Promise.resolve(NetCrunchMetricFindQuery.createQueryResult([]))}}],[{key:'parseQuery',value:function(a){var b=QueryParser.parse(a),c={completeParsed:!1,unparsedQuery:'',tokens:[]};return null!=b&&(c.completeParsed=''===b.residuals,c.unparsedQuery=b.residuals,c.tokens=b.token.value),c}},{key:'processQuery',value:function(a,b,c){function d(r,s){return{success:r,nodes:s}}function e(r,s){var t=[],u=void 0;if(null!=r){if(0===s.length)return t.push.apply(t,_toConsumableArray(r.allNodesId)),t.success=!0,t;// eslint-disable-line prefer-const
if(u=r.getChildMapByDisplayName(s.shift()),null!=u)return e(u,s)}return t.success=!1,t}function f(r,s){var t=new Map,u=[];return r.forEach(function(v){return t.set(v.id,v)}),s.forEach(function(v){t.has(v)&&u.push(t.get(v))}),u}function g(r,s,t){var u=e(s,[].concat(t)),v=[];return u.success&&(v=f(r,u)),d(u.success,v)}function h(r,s){var t=b.atlasMaps.has(s)?b.atlasMaps.get(s):null,u=null!=t,v=u?f(r,t.allNodesId):[];return d(u,v)}function i(r){return function(){return d(!0,r)}}function j(r,s){return d(!0,s.filter(function(t){return t.checkDeviceType(r)}))}function k(r,s){return g(s,b.networkAtlasRoot,r)}function l(r,s){var t=r.shift()?r:[],u=g(s,b.monitoringPacks,t);if(!u.success){var v=NetCrunchDefaultEnglishMonitoringPacks.getMonitoringPackId(t);return null==v?d(!1,[]):h(s,v)}return u}for(var m={nodes:i(c),deviceType:j,networkMap:k,monitoringPack:l},n=void 0,o=!0,p=void 0,q=[];o&&0<a.length;)n=a.shift(),p=m[n.type](n.value,q),o=p.success,o&&(q=p.nodes);return{success:o,nodes:q}}},{key:'createQueryResult',value:function(a){return(a||[]).map(function(b){var c=null==b.address?'':'('+b.address+')';return{text:b.name+' '+c,value:b.id}})}}]),NetCrunchMetricFindQuery}());_export('NetCrunchMetricFindQuery',NetCrunchMetricFindQuery)}}});
//# sourceMappingURL=metricFindQuery.js.map
